<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SleepShare | تجربة النوم الجماعي</title>
  <link rel="stylesheet" href="styles.css" />
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;700&display=swap" rel="stylesheet">
</head>
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCtuWAOF9bCaPGosu0M44NtgL8XhzxNWec",
    authDomain: "sleepshare-fbe2a.firebaseapp.com",
    projectId: "sleepshare-fbe2a",
    storageBucket: "sleepshare-fbe2a.firebasestorage.app",
    messagingSenderId: "357111824676",
    appId: "1:357111824676:web:a425f1db67ea57bef3f3b1",
    measurementId: "G-9BTE9JG8NC"
  };
<button id="logout-btn" class="secondary-btn" style="position: fixed; top: 20px; left: 20px; z-index: 999;">
  تسجيل الخروج
</button>

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);

  // حماية الصفحة
  onAuthStateChanged(auth, (user) => {
    if (!user) {
      // لو غير مسجّل دخول → يرجع للصفحة الرئيسية
      window.location.href = "home.html";
    }
  });
</script>

<body>
  <div class="flow-container">
    <h1 class="app-title">SleepShare</h1>
    <p class="app-subtitle">رحلة النوم الجماعي والوعي الهادئ</p>

    <!-- 1. صفحة الترحيب / الدخول -->
    <section class="sleep-screen" id="screen-welcome">
      <h2 class="step-title">أهلًا بك في SleepShare</h2>
      <p class="step-text">
        هنا تتحوّل لحظة النوم من عزلة فردية إلى انتماء صامت مع آلاف الأرواح حول العالم.
      </p>
      <button class="primary-btn" id="btn-start">
        ابدأ / تسجيل الدخول
      </button>
    </section>

    <!-- 2. صفحة الدخول البسيط (اسم مستعار اختياري) -->
    <section class="sleep-screen" id="screen-auth">
      <h2 class="step-title">دخول هادئ</h2>
      <p class="step-text">
        تم تسجيل دخولك عبر حسابك في SleepShare. يمكنك كتابة اسم مستعار يظهر داخليًا في رحلتك.
      </p>
      <input
        type="text"
        id="input-name"
        class="text-input"
        placeholder="اكتب اسمًا مستعارًا (اختياري)"
      />
      <div class="step-actions">
        <button class="primary-btn" id="btn-auth-continue">متابعة إلى النية</button>
      </div>
    </section>

    <!-- 3. إعلان النية -->
    <section class="sleep-screen" id="screen-intention">
      <h2 class="step-title">إعلان النية للنوم</h2>
      <p class="step-text">
        بضغطك على هذا الزر، تُعلن بهدوء أنك ذاهب للنوم الآن وتنضم إلى شبكة السكون العالمية.
      </p>
      <button class="primary-btn" id="btn-going-to-sleep">
        أنا ذاهب للنوم الآن
      </button>
    </section>

    <!-- 4. اختيار الحالة النفسية -->
    <section class="sleep-screen" id="screen-mood">
      <h2 class="step-title">كيف تشعر الآن؟</h2>
      <p class="step-text">اختر الرمز الأقرب لحالتك الحالية:</p>

      <div class="pill-list" id="mood-list">
        <button class="pill mood-option" data-mood="Wave">Wave – هدوء</button>
        <button class="pill mood-option" data-mood="Stone">Stone – تعب</button>
        <button class="pill mood-option" data-mood="Cloud">Cloud – تشتّت</button>
        <button class="pill mood-option" data-mood="Echo">Echo – حنين</button>
        <button class="pill mood-option" data-mood="Light">Light – تفاؤل</button>
        <button class="pill mood-option" data-mood="Drift">Drift – شرود</button>
        <button class="pill mood-option" data-mood="Focus">Focus – صفاء</button>
        <button class="pill mood-option" data-mood="Ease">Ease – راحة</button>
      </div>

      <p class="step-hint">اضغط على أي رمز للانتقال إلى الغرفة.</p>
    </section>

    <!-- 5. اختيار الغرفة -->
    <section class="sleep-screen" id="screen-room">
      <h2 class="step-title">اختر الغرفة الشعورية</h2>
      <p class="step-text">كل غرفة تحمل لونًا ومزاجًا مختلفًا:</p>

      <div class="pill-list" id="room-list">
        <button class="pill room-option" data-room="Tide Room">Tide Room – غرفة الموج</button>
        <button class="pill room-option" data-room="Hearth Room">Hearth Room – غرفة الدفء</button>
        <button class="pill room-option" data-room="Cave Room">Cave Room – الكهف</button>
        <button class="pill room-option" data-room="Nest Room">Nest Room – العشّ</button>
        <button class="pill room-option" data-room="Nomad Room">Nomad Room – الرحلة</button>
        <button class="pill room-option" data-room="Aurora Room">Aurora Room – الشفق</button>
      </div>

      <p class="step-hint">
        يمكنك تغيير الغرفة لاحقًا، المهم أن تشعر أن هذا هو المكان اللحظي لراحتك.
      </p>
    </section>

    <!-- 6. رسالة الغد -->
    <section class="sleep-screen" id="screen-message">
      <h2 class="step-title">رسالة الغد (مجهولة)</h2>
      <p class="step-text">
        اكتب جملة قصيرة لشخص مجهول سيقرؤها عندما يستيقظ غدًا. يمكن أن تكون كلمة لطف،
        أمل، أو مشاركة شعور عابر.
      </p>
      <textarea
        id="tomorrow-message"
        class="text-area"
        rows="4"
        placeholder="اكتب رسالة بسيطة لشخص مجهول عند استيقاظه..."
      ></textarea>
      <div class="step-actions">
        <button class="secondary-btn" id="btn-skip-message">
          تخطي الرسالة
        </button>
        <button class="primary-btn" id="btn-send-message">
          إرسال الرسالة والذهاب للنوم
        </button>
      </div>
    </section>

    <!-- 7. خريطة السكون -->
    <section class="sleep-screen" id="screen-map">
      <h2 class="step-title">خريطة السكون العالمية</h2>
      <p class="step-text">
        أنت الآن جزء من خريطة ليلية صامتة. النقاط المتوهجة تمثّل أشخاصًا ينامون
        في اللحظة نفسها في غرف شعورية مختلفة.
      </p>

      <div class="map-box">
        <div class="map-stars"></div>
        <p class="map-count">
          النائمون الآن: <span id="sleepers-count">77</span> شخصًا
        </p>
        <p class="current-room-label">
          أنت الآن في <span id="current-room-name">Nomad Room – الرحلة</span>
        </p>
      </div>

      <p class="step-hint">
        للحفاظ على بطارية هاتفك، يمكنك إطفاء الشاشة يدويًا. عند استيقاظك اضغط الزر التالي.
      </p>

      <button class="primary-btn" id="btn-woke-up">
        أنا استيقظت الآن
      </button>
    </section>

    <!-- 8. رسالة مجهول بعد الاستيقاظ -->
    <section class="sleep-screen" id="screen-wake">
      <h2 class="step-title">مرحبًا بعودتك</h2>
      <p class="step-text">
        هذه رسالة رمزية مجهولة من أحد النائمين في شبكة السكون:
      </p>
      <div class="message-card">
        <p id="received-message">
          "كل ليلة فرصة صغيرة لنعيد ترتيب أرواحنا بهدوء، شكرًا لأنك اخترت أن تنام مع
          العالم لا ضده."
        </p>
      </div>

      <button class="primary-btn" id="btn-show-report">
        عرض تقرير النوم والمزاج
      </button>
    </section>

    <!-- 9. تقرير النوم -->
    <section class="sleep-screen" id="screen-report">
      <h2 class="step-title">تقرير نومك الليلي</h2>

      <ul class="report-list">
        <li>الحالة عند النوم: <span id="report-mood">—</span></li>
        <li>الغرفة المختارة: <span id="report-room">—</span></li>
        <li>المدة التقريبية للجلسة: <span id="report-duration">—</span></li>
        <li>مؤشر السكينة (رمزي): <span id="report-serenity">—</span></li>
        <li>التوقيع الحلمي (Dream Signature): <span id="report-dream">—</span></li>
      </ul>

      <p class="step-hint">
        هذا التقرير رمزي وتجريبي، الهدف منه مساعدتك على ملاحظة علاقتك بالنوم
        وتكرار لحظات السكون الواعية.
      </p>

      <button class="secondary-btn" id="btn-reset-flow">
        العودة إلى البداية
      </button>
      <button class="secondary-btn" id="btn-logout">
        تسجيل الخروج
      </button>
    </section>
  </div>

  <!-- Firebase + الحارس + منطق الواجهة -->
  <script type="module" src="firebase.js"></script>
  <script type="module" src="auth-guard.js"></script>
  <script src="main.js"></script>
</body>
</html>
